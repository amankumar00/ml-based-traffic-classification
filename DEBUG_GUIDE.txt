DEBUGGING GUIDE - Why No Packets Are Captured
================================================================================

PROBLEM: data/raw/ is empty, all flows show as ICMP

STEP-BY-STEP DEBUGGING:
================================================================================

STEP 1: Verify Controller is Running and Capturing
---------------------------------------------------

Terminal 1:
conda activate ml-sdn
cd /home/hello/Desktop/ML_SDN
ryu-manager src/controller/sdn_controller.py --verbose

Expected output:
- "loading app src/controller/sdn_controller.py"
- "instantiating app"
- "BRICK TrafficMonitorController"

WAIT for Mininet to connect. You should see:
- "Switch connected: 00000000000000XX"

If you don't see "Switch connected", Mininet isn't connecting!


STEP 2: Check Controller Packet Capture
----------------------------------------

In the controller output, look for these messages every 30 seconds:
- "Periodic save completed"
- "Saved X packets to data/raw/captured_packets_XXXXX.json"

If you see "Periodic save completed" but NO "Saved X packets" message:
→ Controller isn't capturing any packets!

Possible causes:
1. Mininet not connected to controller
2. No traffic being generated
3. Packets not reaching controller


STEP 3: Test with Simple ICMP Only
-----------------------------------

Terminal 1: (controller already running)

Terminal 2:
cd /home/hello/Desktop/ML_SDN
sudo mn -c  # Clean up
sudo -E env "PYTHONPATH=/usr/lib/python3/dist-packages:$PYTHONPATH" python3 topology/custom_topo.py --topology linear --traffic icmp --duration 60

Watch Terminal 1 (controller) for:
- "Switch connected" message
- "packet_in_handler" debug messages (if verbose)
- After 30 seconds: "Periodic save completed" and "Saved X packets"

If packets ARE saved:
→ Controller works, traffic generator is the problem

If packets are NOT saved:
→ Controller or Mininet connection issue


STEP 4: Check Mininet Connection
---------------------------------

When Mininet starts, check Terminal 2 output for:
- "*** Adding controller"
- "*** Starting controller"
- "*** Starting X switches"
- "s1"
- "*** Starting X hosts"
- "h1 h2 h3 ..."

If you don't see switches starting:
→ Mininet initialization failed

If switches start but controller doesn't show "Switch connected":
→ Controller connection failed


STEP 5: Manual Mininet Test
----------------------------

Start controller in Terminal 1, then in Terminal 2:

sudo -E env "PYTHONPATH=/usr/lib/python3/dist-packages:$PYTHONPATH" python3 topology/custom_topo.py --topology linear

This will drop you into Mininet CLI. Try:
mininet> pingall

Check Terminal 1 - you should see packets being captured!

In Mininet CLI:
mininet> h1 ping -c 5 h2

Terminal 1 should show packet captures.

To exit:
mininet> exit


STEP 6: Check What Controller is Actually Seeing
-------------------------------------------------

Add this temporary debug code to controller to see what's happening.

In Terminal 1, stop controller (Ctrl+C) and add print statement:

Edit src/controller/sdn_controller.py, find _extract_packet_features method:

def _extract_packet_features(self, pkt, dpid, in_port):
    """Extract features from packet for ML classification"""
    print(f"DEBUG: Packet received from switch {dpid}")  # ADD THIS LINE
    eth = pkt.get_protocol(ethernet.ethernet)
    ...

Restart controller and run traffic again. You should see "DEBUG: Packet received" messages.

If you see these messages:
→ Controller IS receiving packets, check why they're not being saved

If you don't see these messages:
→ Packets aren't reaching controller at all


COMMON ISSUES AND FIXES:
================================================================================

Issue: "Switch connected" never appears
Fix:
- Make sure controller starts BEFORE Mininet
- Check controller IP/port (default 127.0.0.1:6653)
- Try: sudo ovs-vsctl set-manager ptcp:6640

Issue: Periodic save runs but no files created
Fix:
- Check permissions: ls -ld data/raw/
- Should be: drwxrwxr-x (writable)
- If not: chmod 755 data/raw/

Issue: Files created but empty or only OTHER protocol
Fix:
- This means only ARP/IPv6 packets captured
- No actual traffic generated
- Check traffic generator output
- Try manual ping in Mininet CLI first

Issue: Traffic generator starts then exits immediately
Fix:
- This is expected! With --duration 60, it waits 60 seconds
- Check if background processes actually started
- In Mininet CLI: h1 ps aux (check for ping/wget/nc/iperf)

Issue: All flows classified as ICMP
Fix:
- Check raw JSON files - what protocols are actually in there?
- If raw files have TCP/UDP but extraction only finds ICMP:
  → Feature extraction bug with flow grouping
- If raw files only have ICMP:
  → Traffic generator not working


VERIFICATION CHECKLIST:
================================================================================

Before blaming the code, verify:

□ Controller is running (pgrep -f ryu-manager)
□ Conda environment active (shows "ml-sdn" in prompt)
□ Mininet connects (controller shows "Switch connected")
□ data/raw/ directory exists and is writable
□ Waited at least 35 seconds (first save at 30 seconds)
□ Traffic duration > 30 seconds (otherwise might stop before save)
□ Not running as root (files might be created with wrong permissions)


QUICK DIAGNOSTIC COMMANDS:
================================================================================

# Is controller running?
pgrep -f ryu-manager

# Is Mininet running?
sudo mn -c
# If it says "cleaning up", there was a leftover session

# Check raw data
ls -lh data/raw/

# If files exist, check contents
python3 -c "
import json, glob
files = glob.glob('data/raw/captured_packets_*.json')
for f in files:
    with open(f) as fp:
        data = json.load(fp)
        print(f'{f}: {len(data)} packets')
"

# Check file permissions
ls -ld data/raw/
ls -l data/raw/

# Check if services are running in Mininet (from another terminal while Mininet is active)
sudo netstat -tuln | grep -E "8000|8001|21|22|5001|5002"


NUCLEAR OPTION - Full Reset:
================================================================================

If nothing works:

1. Stop everything:
   pkill -f ryu-manager
   sudo mn -c

2. Clean data:
   rm -rf data/raw/*
   rm -rf data/processed/features.csv

3. Reset controller code (if you added debug statements):
   git checkout src/controller/sdn_controller.py
   # OR restore from backup

4. Start fresh:
   Terminal 1: conda activate ml-sdn && ryu-manager src/controller/sdn_controller.py --verbose
   Terminal 2: Wait 5 seconds, then run traffic test

5. Use simplest test first:
   ./scripts/test_simple_traffic.sh


EXPECTED WORKING OUTPUT:
================================================================================

Terminal 1 (Controller):
loading app src/controller/sdn_controller.py
instantiating app src/controller/sdn_controller.py of TrafficMonitorController
BRICK TrafficMonitorController
Register datapath: 0000000000000001
Switch connected: 0000000000000001
[30 seconds later]
Saved 127 packets to data/raw/captured_packets_1762008425.json
Periodic save completed
[30 seconds later again]
Saved 143 packets to data/raw/captured_packets_1762008455.json
Periodic save completed

Terminal 2 (Mininet):
*** Adding controller
c0
*** Starting controller
c0
*** Starting 2 switches
s1 s2
*** Starting 2 hosts
h1 h2
*** Generating network traffic
Generating ICMP traffic (ping)...
*** Traffic generation started (continuous mode)
*** Traffic will run until network is stopped
*** Running for 60 seconds...
[waits 60 seconds]
*** Stopping network
*** Done

Terminal 3 (Verification):
$ ls -lh data/raw/
-rw-r--r-- 1 hello hello 45K captured_packets_1762008425.json
-rw-r--r-- 1 hello hello 52K captured_packets_1762008455.json

$ python3 -c "import json; data = json.load(open('data/raw/captured_packets_1762008425.json')); print('Packets:', len(data))"
Packets: 127

SUCCESS!
